<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Profile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    
</head>
<body>
    <!-- Header -->
    <header id="header">
        <div class="logo-container">
            <img id="headerProfileImg" alt="Profile Picture" class="logo-img">
            <div class="logo-text" id="headerName">Loading...</div>
        </div>
        
        <nav class="nav-links">
            <a href="#about" class="nav-link">
                <i class="fas fa-user"></i>
                <span>About</span>
            </a>
            <a href="#testimonials" class="nav-link">
                <i class="fas fa-comment-dots"></i>
                <span>Testimonials</span>
            </a>
            <a href="#contact" class="nav-link">
                <i class="fas fa-envelope"></i>
                <span>Contact</span>
            </a>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="profile-container">
            <img id="heroProfileImg" alt="Teacher Profile" class="profile-img">
            <div class="profile-badge">
                <i class="fas fa-award"></i>
            </div>
        </div>
        
        <h1 class="hero-title" id="heroTitle">Loading...</h1>
        <h2 class="hero-subtitle" id="heroSubtitle">Loading...</h2>
        <p class="hero-text" id="heroText">Loading...</p>
    </section>

    <!-- About Section -->
    <section class="section" id="about">
        <h2 class="section-title">About Me</h2>
        
        <div class="about-content">
            <div class="about-image">
                <img id="aboutImage" alt="Teaching">
            </div>
            
            <div class="about-text-content">
                <p class="about-text" id="aboutText1">Loading...</p>
                <p class="about-text" id="aboutText2">Loading...</p>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-number" id="yearsExp">0</div>
                        <div class="stat-label">Years Experience</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="studentsTaught">0</div>
                        <div class="stat-label">Students Taught</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="successRate">0</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section class="section testimonials-section" id="testimonials">
        <h2 class="section-title">Student Testimonials</h2>
        
        <div class="testimonials-container" id="testimonialsContainer">
            <!-- Testimonials will be loaded dynamically -->
        </div>
    </section>

    <!-- Other Teachers Section -->
    <section class="section section-alt" id="otherTeachers">
        <h2 class="section-title">Other Faculty Members</h2>
        
        <div class="teachers-container" id="otherTeachersContainer">
            <!-- Other teachers will be loaded dynamically -->
        </div>
    </section>

    <!-- Contact Section -->
    <section class="section" id="contact">
        <h2 class="section-title">Contact Me</h2>
        
        <div class="contact-container">
            <div class="contact-info">
                <div class="contact-item">
                    <div class="contact-icon">
                        <i class="fas fa-phone-alt"></i>
                    </div>
                    <div class="contact-text">
                        <div class="contact-title">Phone</div>
                        <div class="contact-detail">
                            <a href="#" id="contactPhone">Loading...</a>
                        </div>
                    </div>
                </div>
                
                <div class="contact-item">
                    <div class="contact-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="contact-text">
                        <div class="contact-title">Email</div>
                        <div class="contact-detail">
                            <a href="#" id="contactEmail">Loading...</a>
                        </div>
                    </div>
                </div>
                
                <div class="contact-item">
                    <div class="contact-icon">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                    <div class="contact-text">
                        <div class="contact-title">WhatsApp</div>
                        <div class="contact-detail">
                            <a href="#" id="contactWhatsApp" class="whatsapp-link">Loading...</a>
                        </div>
                    </div>
                </div>
                
                <div class="contact-item">
                    <div class="contact-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="contact-text">
                        <div class="contact-title">Address</div>
                        <div class="contact-detail" id="contactAddress">Loading...</div>
                    </div>
                </div>
            </div>
            
            <div class="contact-form">
                <form id="contactForm">
                    <div class="form-group">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" id="name" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" id="email" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="subject" class="form-label">Subject</label>
                        <input type="text" id="subject" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="message" class="form-label">Message</label>
                        <textarea id="message" class="form-control" required></textarea>
                    </div>
                    
                    <button type="submit" class="submit-btn" id="submitBtn">
                        <i class="fab fa-whatsapp"></i> 
                        <span id="submitText">Send via WhatsApp</span>
                        <div class="spinner" id="spinner"></div>
                    </button>
                </form>
            </div>
        </div>
    </section>

    <footer>
        <div class="footer-content">
            <div class="footer-logo" id="footerName">Loading...</div>
            
            <div class="social-links">
                <a href="#" class="social-link">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="#" class="social-link">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="#" class="social-link">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="#" class="social-link">
                    <i class="fab fa-youtube"></i>
                </a>
            </div>
            
            <div class="copyright">
                &copy; <span id="currentYear"></span> <span id="copyrightName">Loading...</span>. All Rights Reserved.
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <div class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script>
        // Global variables
        let currentTeacher = null;
        let teachers = [];
        let testimonials = {};
        let config = {};

        // Main initialization function
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Load all data first
                await loadAllData();
                
                // Set current year
                setCurrentYear();
                
                // Setup teacher profile based on URL hash
                setupTeacherProfile();
                
                // Setup UI event listeners
                setupEventListeners();
                
            } catch (error) {
                console.error('Initialization error:', error);
                showErrorState();
            }
        });

        // Data loading functions
        async function loadAllData() {
            try {
                // Load all data in parallel
                const [teachersData, testimonialsData, configData] = await Promise.all([
                    loadJSON('../js/teachers.json'),
                    loadJSON('../js/testimonial.json'),
                    
                ]);
                
                teachers = teachersData || [];
                testimonials = testimonialsData || {};
                config = configData || {};
                
            } catch (error) {
                console.error('Error loading data:', error);
                throw error;
            }
        }

        async function loadJSON(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error(`Error loading JSON from ${url}:`, error);
                return null;
            }
        }

        // Teacher profile functions
        function setupTeacherProfile() {
            // Initial load
            loadTeacherFromHash();
            
            // Listen for hash changes
            window.addEventListener('hashchange', loadTeacherFromHash);
        }

        function loadTeacherFromHash() {
            const teacherId = window.location.hash.substring(1);
            const teacher = findTeacherById(teacherId) || getDefaultTeacher();
            
            if (teacher) {
                currentTeacher = teacher;
                renderTeacherProfile(teacher);
                updateURLHash(teacher.id);
                window.scrollTo({ top: 0, behavior: 'instant' });
            }
        }

        function findTeacherById(id) {
            return teachers.find(t => t.id === id);
        }

        function getDefaultTeacher() {
            return teachers.length > 0 ? teachers[0] : null;
        }

        function updateURLHash(teacherId) {
            if (window.location.hash.substring(1) !== teacherId) {
                window.location.hash = `#${teacherId}`;
            }
        }

        function renderTeacherProfile(teacher) {
            if (!teacher) return;
            
            updateHeaderSection(teacher);
            updateHeroSection(teacher);
            updateAboutSection(teacher);
            updateContactSection(teacher);
            updateFooterSection(teacher);
            
            loadTestimonials(teacher.id);
            loadOtherTeachers(teacher.id);
        }

        // Section update functions
        function updateHeaderSection(teacher) {
            setElementContent('headerName', teacher.name);
            setElementAttribute('headerProfileImg', 'src', `../${teacher.image}`);
            setElementAttribute('headerProfileImg', 'alt', teacher.name);
        }

        function updateHeroSection(teacher) {
            setElementContent('heroTitle', teacher.heroTitle || teacher.name);
            setElementContent('heroSubtitle', teacher.heroSubtitle || teacher.title);
            setElementContent('heroText', teacher.heroText || teacher.bio);
            setElementAttribute('heroProfileImg', 'src', `../${teacher.image}`);
            setElementAttribute('heroProfileImg', 'alt', teacher.name);
        }

        function updateAboutSection(teacher) {
            setElementContent('aboutText1', teacher.aboutText1 || teacher.bio);
            setElementContent('aboutText2', teacher.aboutText2 || '');
            setElementAttribute('aboutImage', 'src', `../${teacher.aboutImage || teacher.image}`);
            setElementAttribute('aboutImage', 'alt', `${teacher.name} teaching`);
            
            if (teacher.stats) {
                animateValue('yearsExp', teacher.stats.yearsExp);
                animateValue('studentsTaught', teacher.stats.studentsTaught);
                animateValue('successRate', teacher.stats.successRate);
            }
        }

        function updateContactSection(teacher) {
            // Phone
            const phoneLink = document.getElementById('contactPhone');
            if (phoneLink) {
                phoneLink.textContent = teacher.contact.phone;
                phoneLink.href = `tel:${teacher.contact.phone}`;
            }
            
            // Email
            const emailLink = document.getElementById('contactEmail');
            if (emailLink) {
                emailLink.textContent = teacher.contact.email;
                emailLink.href = `mailto:${teacher.contact.email}`;
            }
            
            // WhatsApp
            const whatsappLink = document.getElementById('contactWhatsApp');
            if (whatsappLink) {
                whatsappLink.textContent = teacher.contact.whatsapp;
                whatsappLink.href = getWhatsAppUrl(teacher);
                whatsappLink.classList.add('whatsapp-link');
            }
            
            // Address
            setElementContent('contactAddress', teacher.contact.address);
        }

        function updateFooterSection(teacher) {
            setElementContent('footerName', teacher.name);
            setElementContent('copyrightName', teacher.name);
        }

        function getWhatsAppUrl(teacher) {
            const baseMessage = `Hello ${teacher.name}, I have a question about your classes`;
            return `https://wa.me/${teacher.contact.whatsapp}?text=${encodeURIComponent(baseMessage)}`;
        }

        // Testimonials functions
        function loadTestimonials(teacherId) {
            const container = document.getElementById('testimonialsContainer');
            if (!container) return;
            
            const teacherTestimonials = testimonials[teacherId] || [];
            
            if (teacherTestimonials.length === 0) {
                container.innerHTML = `
                    <div class="no-testimonials">
                        <p>No testimonials available yet for this teacher.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = teacherTestimonials.map(createTestimonialElement).join('');
        }

        function createTestimonialElement(testimonial) {
            return `
                <div class="testimonial">
                    <div class="testimonial-content">
                        <p class="testimonial-text">${testimonial.text}</p>
                        ${testimonial.urduText ? `<p class="testimonial-text testimonial-urdu">${testimonial.urduText}</p>` : ''}
                    </div>
                    <div class="testimonial-author">
                        <img src="../${testimonial.author.image}" alt="${testimonial.author.name}" class="author-img">
                        <div class="author-info">
                            <div class="author-name">${testimonial.author.name}</div>
                            <div class="author-title">${testimonial.author.title}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Other teachers functions
        function loadOtherTeachers(excludeTeacherId) {
            const container = document.getElementById('otherTeachersContainer');
            if (!container) return;
            
            const otherTeachers = teachers.filter(teacher => teacher.id !== excludeTeacherId);
            
            if (otherTeachers.length === 0) {
                container.innerHTML = '<p>No other faculty members available.</p>';
                return;
            }
            
            container.innerHTML = otherTeachers.map(createTeacherCard).join('');
        }

        function createTeacherCard(teacher) {
            return `
                <div class="teacher-card">
                    <div class="teacher-img-container">
                        <img src="../${teacher.image}" alt="${teacher.name}" class="teacher-img">
                        <span class="teacher-specialty">${teacher.specialty}</span>
                    </div>
                    <h3 class="teacher-name">${teacher.name}</h3>
                    <div class="teacher-subject">${teacher.title}</div>
                    <p class="teacher-bio">${teacher.bio}</p>
                    <a href="./#${teacher.id}" class="view-profile">View Profile</a>
                </div>
            `;
        }

        // Utility functions
        function setCurrentYear() {
            setElementContent('currentYear', new Date().getFullYear());
        }

        function setElementContent(elementId, content) {
            const element = document.getElementById(elementId);
            if (element) element.textContent = content;
        }

        function setElementAttribute(elementId, attribute, value) {
            const element = document.getElementById(elementId);
            if (element) element.setAttribute(attribute, value);
        }

        function animateValue(elementId, endValue, duration = 2000) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            let startTime = null;
            const startValue = 0;
            
            const animation = (currentTime) => {
                if (!startTime) startTime = currentTime;
                const progress = Math.min((currentTime - startTime) / duration, 1);
                const value = Math.floor(progress * (endValue - startValue) + startValue);
                element.textContent = progress === 1 ? `${value}+` : value;
                
                if (progress < 1) {
                    window.requestAnimationFrame(animation);
                }
            };
            
            window.requestAnimationFrame(animation);
        }

        // Event handling functions
        function setupEventListeners() {
            setupScrollEffects();
            setupBackToTopButton();
            setupSmoothScrolling();
            setupContactForm();
        }

        function setupScrollEffects() {
            const header = document.getElementById('header');
            if (!header) return;
            
            window.addEventListener('scroll', () => {
                header.classList.toggle('scrolled', window.scrollY > 50);
            });
        }

        function setupBackToTopButton() {
            const backToTop = document.getElementById('backToTop');
            if (!backToTop) return;
            
            window.addEventListener('scroll', () => {
                backToTop.classList.toggle('visible', window.scrollY > 300);
            });
            
            backToTop.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }

        function setupSmoothScrolling() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    if (!this.classList.contains('view-profile')) {
                        e.preventDefault();
                        const targetId = this.getAttribute('href');
                        scrollToSection(targetId);
                    }
                });
            });
        }

        function scrollToSection(targetId) {
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                window.scrollTo({
                    top: targetElement.offsetTop - 80,
                    behavior: 'smooth'
                });
            }
        }

        function setupContactForm() {
            const contactForm = document.getElementById('contactForm');
            if (!contactForm) return;
            
            contactForm.addEventListener('submit', handleFormSubmit);
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const spinner = document.getElementById('spinner');
            
            if (!submitBtn || !submitText || !spinner || !currentTeacher) return;
            
            // Show loading state
            submitBtn.disabled = true;
            submitText.textContent = 'Sending...';
            spinner.style.display = 'block';
            
            try {
                const formData = getFormData();
                
                if (!validateFormData(formData)) {
                    return;
                }
                
                const whatsappUrl = createWhatsAppUrl(formData);
                window.open(whatsappUrl, '_blank');
                e.target.reset();
                
            } catch (error) {
                console.error('Form submission error:', error);
                alert('An error occurred. Please try again.');
            } finally {
                resetButtonState();
            }
        }

        function getFormData() {
            return {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                subject: document.getElementById('subject').value,
                message: document.getElementById('message').value
            };
        }

        function validateFormData(formData) {
            if (!formData.name || !formData.subject || !formData.message) {
                alert('Please fill in all required fields');
                return false;
            }
            
            if (formData.email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email)) {
                alert('Please enter a valid email address');
                return false;
            }
            
            return true;
        }

        function createWhatsAppUrl(formData) {
            const message = `New Contact Form Submission:\n\n` +
                `Name: ${formData.name}\n` +
                `Email: ${formData.email || 'Not provided'}\n` +
                `Subject: ${formData.subject}\n\n` +
                `Message:\n${formData.message}`;
            
            return `https://wa.me/${currentTeacher.contact.whatsapp}?text=${encodeURIComponent(message)}`;
        }

        function resetButtonState() {
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const spinner = document.getElementById('spinner');
            
            if (submitBtn && submitText && spinner) {
                submitBtn.disabled = false;
                submitText.textContent = 'Send via WhatsApp';
                spinner.style.display = 'none';
            }
        }

        function showErrorState() {
            // Basic error handling - could be enhanced with a proper error UI
            alert('Failed to load page data. Please try refreshing the page.');
        }
    </script>
</body>
</html>
